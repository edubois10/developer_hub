redhat-developer-hub:
    global:
      auth:
        backend:
          enabled: true
          existingSecret: rhdh-backend-auth
      clusterRouterBase: apps.cluster-5clzf.5clzf.sandbox2839.opentlc.com
      dynamic:
        includes:
          - dynamic-plugins.default.yaml
        plugins:
          - package: ./dynamic-plugins/dist/backstage-plugin-techdocs
            disabled: false
          - package: ./dynamic-plugins/dist/backstage-plugin-techdocs-backend-dynamic
            disabled: false
          - package: ./dynamic-plugins/dist/roadiehq-backstage-plugin-argo-cd-backend-dynamic
            disabled: false
          - package: ./dynamic-plugins/dist/backstage-community-plugin-redhat-argocd
            disabled: false
          - package: ./dynamic-plugins/dist/janus-idp-backstage-plugin-keycloak-backend-dynamic
            disabled: false
          - package: './dynamic-plugins/dist/janus-idp-backstage-plugin-rbac'
            disabled: false
    
    upstream:
        backstage:
          extraAppConfig:
            - filename: app-config-base.yaml
              configMapRef: app-configs-base
            - filename: app-config-argocd.yaml
              configMapRef: app-configs-argocd
            - filename: app-config-techdocs.yaml
              configMapRef: app-configs-techdocs
            - filename: app-config-keycloak.yaml
              configMapRef: app-configs-keycloak
            - filename: app-config-github.yaml
              configMapRef: app-configs-github
            - filename: app-config-rbac.yaml
              configMapRef: app-configs-rbac
          
          extraVolumes:
            # -- Ephemeral volume that will contain the dynamic plugins installed by the initContainer below at start.
            - name: dynamic-plugins-root
              persistentVolumeClaim:
                claimName: '{{ printf "%s-dynamic-plugins-root" .Release.Name }}'
            - name: audit-log-data
              persistentVolumeClaim:
                claimName: '{{ printf "%s-audit-log" .Release.Name }}'
            # Volume that will expose the `dynamic-plugins.yaml` file from the `dynamic-plugins` config map.
            # The `dynamic-plugins` config map is created by the helm chart from the content of the `global.dynamic` field.
            - name: dynamic-plugins
              configMap:
                defaultMode: 420
                name: '{{ printf "%s-dynamic-plugins" .Release.Name }}'
                optional: true
            # Optional volume that allows exposing the `.npmrc` file (through a `dynamic-plugins-npmrc` secret)
            # to be used when running `npm pack` during the dynamic plugins installation by the initContainer.
            - name: dynamic-plugins-npmrc
              secret:
                defaultMode: 420
                optional: true
                secretName: '{{ printf "%s-dynamic-plugins-npmrc" .Release.Name }}'
            # Optional volume that allows adding a container registry `auth.json` file (through a `dynamic-plugins-registry-auth` secret)
            # to be used when installing plugins from secure container registries during the dynamic plugins installation by the initContainer.
            - name: dynamic-plugins-registry-auth
              secret:
                defaultMode: 416
                optional: true
                secretName: '{{ printf "%s-dynamic-plugins-registry-auth" .Release.Name }}'
            - name: npmcacache
              emptyDir: {}
            - name: rbac-policy
              configMap:
                defaultMode: 420
                name: rbac-policy
          
          extraVolumeMounts:
            # The initContainer below will install dynamic plugins in this volume mount.
            - name: dynamic-plugins-root
              mountPath: /opt/app-root/src/dynamic-plugins-root
            - name: rbac-policy
              mountPath: opt/app-root/src/rbac
            - name: audit-log-data
              mountPath: /var/log/rhdh/audits
          
          extraEnvVars:
            -   name: NODE_TLS_REJECT_UNAUTHORIZED
                value: '0'
            -   name: BACKEND_SECRET
                valueFrom:
                    secretKeyRef:
                        key: backend-secret
                        name: '{{ include "janus-idp.backend-secret-name" $ }}'
            -   name: POSTGRESQL_ADMIN_PASSWORD
                valueFrom:
                    secretKeyRef:
                        key: postgres-password
                        name: rhdh-postgres-auths
            -   name: GITHUB_TOKEN
                valueFrom:
                    secretKeyRef:
                        key: github-token
                        name: rhdh-github-token
            -   name: ARGOCD_USER
                valueFrom:
                    secretKeyRef:
                        key: argocd-username
                        name: rhdh-argocd-auths
            -   name: ARGOCD_RHDH_PASSWORD
                valueFrom:
                    secretKeyRef:
                        key: argocd-rhdh-password
                        name: rhdh-argocd-auths
            -   name: KUBERNETES_TOKEN
                valueFrom:
                    secretKeyRef:
                        key: token
                        name: rhdh-kubernetes-token
            -   name: RHDH_SESSION_SECRET
                valueFrom:
                    secretKeyRef:
                        key: session-secret
                        name: keycloak-plugin
            -   name: RHBK_RHDH_REALM_METADATA_URL
                valueFrom:
                    secretKeyRef:
                        key: realm-metadata-url
                        name: keycloak-plugin
            -   name: RHBK_RHDH_CLIENT_ID
                valueFrom:
                    secretKeyRef:
                        key: client-id
                        name: keycloak-plugin
            -   name: RHBK_RHDH_CLIENT_SECRET
                valueFrom:
                    secretKeyRef:
                        key: client-secret
                        name: keycloak-plugin
            -   name: RHBK_BASE_URL
                valueFrom:
                    secretKeyRef:
                        key: rhbk-base-url
                        name: keycloak-plugin
            -   name: RHBK_RHDH_REALM
                valueFrom:
                    secretKeyRef:
                        key: rhbk-rhdh-realm
                        name: keycloak-plugin
            -   name: RHDH_URL
                valueFrom:
                    secretKeyRef:
                        key: rhdh-url
                        name: keycloak-plugin
            -   configMap:
                    defaultMode: 420
                    name: dynamic-plugins
                    optional: true
                name: dynamic-plugins
            -   name: dynamic-plugins-npmrc
                secret:
                    defaultMode: 420
                    optional: true
                    secretName: dynamic-plugins-npmrc
          image:
            registry: registry.redhat.io
            repository: rhdh/rhdh-hub-rhel9
            tag: 1.3-124.1731508449
        postgresql:
          auth:
              existingSecret: rhdh-postgres-auths
          enabled: true
